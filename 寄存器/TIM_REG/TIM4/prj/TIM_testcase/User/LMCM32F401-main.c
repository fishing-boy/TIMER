#include "uart.h"
#include "stdio.h"

#include <stm32f4xx.h>
#include <stm32f4xx_flash.h>

//测试部件选择开关区
void TIM_W(unsigned int data);

int main()
{
	UartStdOutInit();  //uart初始化
	printf("TEXT START\r\n"); 

	*((int*)0x40023840) |= 0x0000000f;  
	*((int*)0x40023844) |= 0x00070001;

	TIM_W(0xffffffff);
	TIM_W(0x00000000);
	TIM_W(0xA5A5A5A5);
	TIM_W(0x5A5A5A5A);

	while (1)
	{
		/* code */
	}
	
}



unsigned int TIM_REG_ADDRESS[8][20] = 
{
	{   //TIM1
		0x40010010,0x40010044,0x40010030,0x4001004c,0x40010048,
		0x40010040,0x4001003c,0x40010038,0x40010034,0x4001002c,
		0x40010028,0x40010024,0x40010020,0x4001001c,0x40010018,
		0x40010014,0x4001000c,0x40010008,0x40010004,0x40010000
	},
	{  //TIM2
		0x40000010,0x40000050,0x4000004c,0x40000048,0x40000040,
		0x4000003c,0x40000038,0x40000034,0x4000002c,0x40000028,
		0x40000024,0x40000020,0x4000001c,0x40000018,0x40000014,
		0x4000000c,0x40000008,0x40000004,0x40000000,0x00000000
	},
	{  //TIM3
		0x40000410,0x4000044c,0x40000448,0x40000440,0x4000043c,
		0x40000438,0x40000434,0x4000042c,0x40000428,0x40000424,
		0x40000420,0x4000041c,0x40000418,0x40000414,0x4000040c,
		0x40000408,0x40000404,0x40000000,0x00000000,0x00000000
	},
	{  //TIM4
		0x40000810,0x4000084c,0x40000848,0x40000840,0x4000083c,
		0x40000838,0x40000834,0x4000082c,0x40000828,0x40000824,
		0x40000820,0x4000081c,0x40000818,0x40000814,0x4000080c,
		0x40000808,0x40000804,0x40000800,0x00000000,0x00000000
	},
	{	//TIM5
		0x40000c10,0x40000c50,0x40000c4c,0x40000c48,0x40000c40,
		0x40000c3c,0x40000c38,0x40000c34,0x40000c2c,0x40000c28,
		0x40000c24,0x40000c20,0x40000c1c,0x40000c18,0x40000c14,
		0x40000c0c,0x40000c08,0x40000c04,0x40000c00,0x00000000
	},
	/*
	{	//TIM8
		0x40010410,0x40010444,0x40010430,0x4001044c,0x40010448,
		0x40010440,0x4001043c,0x40010438,0x40010434,0x4001042c,
		0x40010428,0x40010424,0x40010420,0x4001041c,0x40010418,
		0x40010414,0x4001040c,0x40010408,0x40010404,0x40010400
	},*/
	{	//TIM9
		0x40014010,0x40014038,0x40014034,0x4001402c,0x40014028,
		0x40014024,0x40014020,0x40014018,0x40014014,0x4001400c,
		0x40014008,0x40014004,0x40014000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
	},
	{	//TIM10
		0x40014410,0x40014434,0x4001442c,0x40014428,0x40014424,
		0x40014420,0x40014418,0x40014414,0x4001440c,0x40014400,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
	},
	{	//TIM11
		0x40014810,0x40014850,0x40014834,0x4001482c,0x40014828,
		0x40014824,0x40014820,0x40014818,0x40014814,0x4001480c,
		0x40014800,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
	}

};

unsigned int TIM_W_FF[8][20] =
{
	{	//TIM1
		0x00000000,0x0000ffff,0x000000ff,0x000003ef,0x00001f1f,
		0x0000ffff,0x0000ffff,0x0000ffff,0x0000ffff,0x0000ffff,
		0x0000ffff,0x0000fffc,0x00001555,0x00008787,0x00008787,
		0x00000000,0x0000ffff,0x0000fff7,0x000000fd,0x000003ff
	},
	{	//TIM2
		0x00000000,0x00007fff,0x000003ef,0x00001f1f,0xffffffff,
		0xffffffff,0xffffffff,0xffffffff,0xffffffff,0x0000ffff,
		0xfffffffd,0x0000bbbb,0x0000ffff,0x0000ffff,0x00000000,
		0x00005f5f,0x0000fff7,0x000000f8,0x000003ff,0x200009f8,
	},
	{	//TIM3
		0x00000000,0x000003ef,0x00001f1f,0x0000ffff,0x0000ffff,
		0x0000ffff,0x0000ffff,0x0000ffff,0x0000ffff,0x0000fffd,
		0x0000bbbb,0x0000ffff,0x0000ffff,0x00000000,0x00005f5f,
		0x0000fff7,0x000000f8,0x000003ff,0x20000cc8,0x20000cc8,
	},
	{	//TIM4
		0x00000000,0x000003ef,0x00001f1f,0x0000ffff,0x0000ffff,
		0x0000ffff,0x0000ffff,0x0000ffff,0x0000ffff,0x00000000,
		0x0000bbbb,0x0000ffff,0x0000ffff,0x00000000,0x00005f5f,
        0x0000fff7,0x000000f8,0x000003ff,0x00000000,0x00000000
	},
    {	//TIM5
        0x00000000,0x00007fff,0x000003ef,0x00001f1f,0xffffffff,
		0xffffffff,0xffffffff,0xffffffff,0xffffffff,0x0000ffff,
		0xffffffff,0x0000bbbb,0x0000ffff,0x0000ffff,0x00000000,
		0x00005f5f,0x0000fff7,0x000000f8,0x000003ff,0x20000b88
	},
	{	//TIM9
		0x00000000,0x0000ffff,0x0000ffff,0x0000ffff,0x0000ffff,
		0x0000ffff,0x000000bb,0x0000ffff,0x00000000,0x00000047,
		0x000000f7,0x000000f0,0x0000038f,0x20000b88,0x20000b88,
		0x20000b88,0x20000b88,0x20000b88,0x20000b88,0x20000b88
    },
	{	//TIM10
		0x00000000,0x0000ffff,0x0000ffff,0x0000ffff,0x0000ffff,
		0x0000000b,0x000000ff,0x00000000,0x00000003,0x0000038f,
		0x20000b88,0x20000b88,0x20000b88,0x20000b88,0x20000b88,
		0x20000b88,0x20000b88,0x20000b88,0x20000b88,0x20000b88
	},
	{
		0x00000000,0x00007fff,0x0000ffff,0x0000ffff,0x0000ffff,
		0x0000ffff,0x0000000b,0x000000ff,0x00000000,0x00000003,
		0x0000038f,0x20000b88,0x20000b88,0x20000b88,0x20000b88,
		0x20000b88,0x20000b88,0x20000b88,0x20000b88,0x20000b88,
	}
};

unsigned int TIM_W_00[8][20] = 
{
	{
		0x00000000,0x00007fff,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
	},
	{
		0
	}
};

unsigned int TIM_W_A5[8][20] =
{
	{	//TIM1
		0x00000000,0x0000ffff,0x000000a5,0x000001a5,0x00000505,
		0x0000a5a5,0x0000a5a5,0x0000a5a5,0x0000a5a5,0x0000a5a5,
		0x0000a5a5,0x0000a5a2,0x00000505,0x00008585,0x00008585,
		0x00000000,0x0000a5a5,0x0000a5a5,0x000000a5,0x000001a5
	},
	{	//TIM2
		0x00000000,0x000025a5,0x000001a5,0x00000505,0xa5a5a5a5,
		0xa5a5a5a5,0xa5a5a5a5,0xa5a5a5a5,0xa5a5a5a5,0x0000a5a5,
		0xa5a5a5a9,0x0000a1a1,0x0000a5a5,0x0000a5a5,0x00000000,
		0x00000505,0x0000a5a5,0x000000a0,0x000001a5,0x20000908
	},
	{	//TIM3
		0x00000000,0x000001a5,0x00000505,0x0000a5a5,0x0000a5a5,
		0x0000a5a5,0x0000a5a5,0x0000a5a5,0x0000a5a5,0x0000a5a5,
		0x0000a1a1,0x0000a5a5,0x0000a5a5,0x00000000,0x00000505,
		0x0000a5a5,0x000000a0,0x000001a5,0x20000908,0x20000908
	},
	{	//TIM4
		0x00000000,0x000001a5,0x00000505,0x0000a5a5,0x0000a5a5,
		0x0000a5a5,0x0000a5a5,0x0000a5a5,0x0000a5a5,0x0000a5a5,
		0x0000a1a1,0x0000a5a5,0x0000a5a5,0x00000000,0x00000505,
		0x0000a5a5,0x000000a0,0x000001a5,0x20000908,0x20000908
	},
    {	//TIM5
        0x00000000,0x000025a5,0x000001a5,0x00000505,0xa5a5a5a5,
		0xa5a5a5a5,0xa5a5a5a5,0xa5a5a5a5,0xa5a5a5a5,0x0000a5a5,
		0xa5a5a5a9,0x0000a1a1,0x0000a5a5,0x0000a5a5,0x00000000,
		0x00000505,0x0000a5a5,0x000000a0,0x000001a5,0x20000908
	},
	{	//TIM9
		0x00000000,0x0000a5a5,0x0000a5a5,0x0000a5a5,0x0000a5a5,
		0x0000a5a5,0x000000a1,0x0000a5a5,0x00000000,0x00000005,
		0x000000a5,0x000000a0,0x00000185,0x20000908,0x20000908,
		0x20000908,0x20000908,0x20000908,0x20000908,0x20000908
    },
	{	//TIM10
		0x00000000,0x0000a5a5,0x0000a5a5,0x0000a5a5,0x0000a5a5,
		0x00000001,0x000000a5,0x00000000,0x00000001,0x00000185,
		0x20000908,0x20000908,0x20000908,0x20000908,0x20000908,
		0x20000908,0x20000908,0x20000908,0x20000908,0x20000908
	},
	{
		0x00000000,0x000025a5,0x0000a5a5,0x0000a5a5,0x0000a5a5,
		0x0000a5a5,0x00000001,0x000000a5,0x00000000,0x00000001,
		0x00000185,0x20000908,0x20000908,0x20000908,0x20000908,
		0x20000908,0x20000908,0x20000908,0x20000908,0x20000908
	}
};

unsigned int TIM_W_5A[8][20] =
{
	{	//TIM1
		0x0000001a,0x00007fff,0x0000005a,0x0000025a,0x00001a1a,
		0x00005a5a,0x00005a5a,0x00005a5a,0x00005a5a,0x00005a5a,
		0x00005a5a,0x00005a5a,0x00001050,0x00000202,0x00000202,
		0x00000000,0x00005a5a,0x00005a52,0x00000058,0x0000025a
	},
	{	//TIM2
		0x0000001a,0x00005a5a,0x0000025a,0x00001a1a,0x5a5a5a5a,
		0x5a5a5a5a,0x5a5a5a5a,0x5a5a5a5a,0x5a5a5a5a,0x00005a5a,
		0x5a5a5a5a,0x00001a1a,0x00005a5a,0x00005a5a,0x00000000,
		0x00005a5a,0x00005a52,0x00000058,0x0000025a,0x20000b88
	},
	{	//TIM3
		0x0000001a,0x0000025a,0x00001a1a,0x00005a5a,0x00005a5a,
		0x00005a5a,0x00005a5a,0x00005a5a,0x00005a5a,0x00005a5a,
		0x00001a1a,0x00005a5a,0x00005a5a,0x00000000,0x00005a5a,
		0x00005a52,0x00000058,0x0000025a,0x20000b88,0x20000b88
	},
	{	//TIM4
		0x0000001a,0x0000025a,0x00001a1a,0x00005a5a,0x00005a5a,
		0x00005a5a,0x00005a5a,0x00005a5a,0x00005a5a,0x00005a5a,
		0x00001a1a,0x00005a5a,0x00005a5a,0x00000000,0x00005a5a,
		0x00005a52,0x00000058,0x0000025a,0x20000b88,0x20000b88
	},
    {	//TIM5
        0x0000001a,0x00005a5a,0x0000025a,0x00001a1a,0x5a5a5a5a,
		0x5a5a5a5a,0x5a5a5a5a,0x5a5a5a5a,0x5a5a5a5a,0x00005a5a,
		0x5a5a5a5a,0x00001a1a,0x00005a5a,0x00005a5a,0x00000000,
		0x00005a5a,0x00005a52,0x00000058,0x0000025a,0x20000b88
	},
	{	//TIM9
		0x00000002,0x00005a5a,0x00005a5a,0x00005a5a,0x00005a5a,
		0x00005a5a,0x0000001a,0x00005a5a,0x00000000,0x00000042,
		0x00000052,0x00000050,0x0000020a,0x20000b88,0x20000b88,
		0x20000b88,0x20000b88,0x20000b88,0x20000b88,0x20000b88
    },
	{	//TIM10
		0x00000002,0x00005a5a,0x00005a5a,0x00005a5a,0x00005a5a,
		0x0000000a,0x0000005a,0x00000000,0x00000002,0x0000020a,
		0x20000b88,0x20000b88,0x20000b88,0x20000b88,0x20000b88,
		0x20000b88,0x20000b88,0x20000b88,0x20000b88,0x20000b88
	},
	{
		0x00000002,0x00005a5a,0x00005a5a,0x00005a5a,0x00005a5a,
		0x00005a5a,0x0000000a,0x0000005a,0x00000000,0x00000002,
		0x0000020a,0x20000b88,0x20000b88,0x20000b88,0x20000b88,
		0x20000b88,0x20000b88,0x20000b88,0x20000b88,0x20000b88
	}
};

unsigned int TIM_REG_VALE[8][20] = 
{
	{	//TIM1
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
	},
	{	//TIM2
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
	},
	{	//TIM3
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
	},
	{	//TIM4
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
	},
	{	//TIM5
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
	},
	{  //TIM9
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
	},
	{  //TIM10
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
	},
	{  //TIM11
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,
		0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
	},
};


void TIM_W(unsigned int data)
{
	for (int i = 3; i < 4; i++)
	{
		int check = 0;
		unsigned int expected = 0;
		for (int j = 0; j < 20; j++)
		{
			*((int*)TIM_REG_ADDRESS[i][j]) = data;

			unsigned int vale = *((int*)TIM_REG_ADDRESS[i][j]);
			//printf("0x%08x,",vale);

			if(data == 0xFFFFFFFF)
			{
				expected = TIM_W_FF[i][j];
			}
			else if(data == 0x00000000)
			{
				expected = TIM_W_00[i][j];
			}
			else if(data == 0xA5A5A5A5)
			{
				expected = TIM_W_A5[i][j];
			}
			else if(data == 0x5A5A5A5A)
			{
				expected = TIM_W_5A[i][j];
			}
			
			if(((TIM_REG_ADDRESS[i][j]&0x000000ff) != 0x00000024)  && (TIM_REG_ADDRESS[i][j] != 0))  //cnt的数据不看
			{
				if(vale != expected)
				{
					printf("0x%08x wirte 0x%08x fail,vale = 0x%08x,expected value = 0x%08x\r\n",TIM_REG_ADDRESS[i][j],data,vale,expected);
					check += 1; 
				}
				else{
					printf("0x%08x wirte 0x%08x success,vale = 0x%08x\r\n",TIM_REG_ADDRESS[i][j],data,vale);
				}
				*((int*)TIM_REG_ADDRESS[i][j]) = TIM_REG_VALE[i][j];
			}
		}
		
		printf("\r\n");	
		int num;
		switch (i)
		{
			case 0: 
				num = 1;
				break;
			case 1: 
				num = 2;
				break;
			case 2: 
				num = 3;
				break;
			case 3: 
				num = 4;
				break;
			case 4: 
				num = 5;
				break;
			case 5:
				num = 9;
				break;
			case 6:
				num = 10;
				break;
			case 7:
				num = 11;
				break;
			default:
				break;
		}
		if(!check)
		{
			printf("TIM%d write 0x%08x test pass\r\n",num,data);
		}
		else
		{
			printf("TIM%d write 0x%08x test fail,error number: %d\r\n",num,data,check);
		}
	}
	
}
